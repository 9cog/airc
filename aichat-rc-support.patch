# Plan 9 RC Shell Support Patch for aichat
# 
# This patch adds Plan 9 rc shell support to sigoden/aichat
# Target: aichat v0.21.0 and later (tested with main branch as of 2026-01)
# 
# Apply with:
#   cd aichat
#   patch -p1 < /path/to/aichat-rc-support.patch
#
# Changes:
# - Adds rc shell detection in Shell::detect()
# - Adds rc history file location support
# - Adds rc history format (simple line-by-line)
#
--- a/src/utils/command.rs
+++ b/src/utils/command.rs
@@ -45,6 +45,7 @@ impl Shell {
     pub fn detect() -> Self {
         let cmd = env::var("SHELL").ok().or_else(|| {
             if cfg!(windows) {
+                // Windows shell detection
                 if let Ok(ps_module_path) = env::var("PSModulePath") {
                     let ps_module_path = ps_module_path.to_lowercase();
                     if ps_module_path.starts_with(r"c:\users") {
@@ -74,6 +75,7 @@ impl Shell {
         };
         let shell_arg = match name {
             "powershell" | "pwsh" => "-Command",
+            "rc" => "-c",  // Plan 9 rc shell uses -c like bash/zsh/fish
             "cmd" => "/C",
             _ => "-c",
         };
@@ -120,6 +122,9 @@ pub fn append_to_shell_history(shell: &str, command: &str, exit_code: i32) -> 
         let now = now_timestamp();
         let history_txt = if shell == "fish" {
             format!("- cmd: {command}\n  when: {now}")
+        } else if shell == "rc" {
+            // Plan 9 rc shell: simple format, just append the command (like bash/sh)
+            command.to_string()
         } else if shell == "zsh" {
             format!(": {now}:{exit_code};{command}",)
         } else {
@@ -150,6 +155,11 @@ fn get_history_file(shell: &str) -> Option<PathBuf> {
             .ok()
             .map(PathBuf::from)
             .or(Some(home_dir()?.join(".bash_history"))),
+        "rc" => env::var("history")
+            .ok()
+            .map(PathBuf::from)
+            .or_else(|| Some(home_dir()?.join(".rc_history"))),
+            // Check $history env var first, then default to ~/.rc_history
         "zsh" => env::var("HISTFILE")
             .ok()
             .map(PathBuf::from)
